# Reading ".NET IL Assembler"

## ilのコンパイル方法

    > call "%vs120comntools%vsvars32.bat"
    > ilasm.exe myasm.il

## 1章

* `.assembly extern` はアセンブリ参照を定義するもの。
  * 続くアセンブリ名にはファイル名を指定しない。
    * `mscorlib.dll` と指定してしまうと `mscorlib.dll.dll` だとか `mscorlib.dll.exe` が検索されてしまうので
      見つからずランタイムエラーになる。
  * `{ auto }` とするとバージョンを自動検出する。
    * ただし `1.0` と `1.1` には自動検出機能がないので注意。
* `.assembly <name>` で`Assembly`という名前のメタデータを定義。
* `.module <name>` で`Module`という名前のメタデータを定義。
* 値型と列挙型には疑似フラグ `value` と `enum` を指定出来る。
  * ただし `extends` が指定された場合はこれらのフラグは無視される。
* `TypeDef` ブロックは一度クローズしても、別の場所でオープンしなおすことが可能。
  * `amendment` (改正、修正)と呼ばれるテクニック。
  * `TypeDef` の改正時に指定されたフラグや`extends` `implement` 句は無視される。
    つまりこれらは最初の`TypeDef`定義時に指定すべき。
* アクセス修飾子
  * `public`は任意の場所にあるアセンブリからアクセス可能。
  * `assembly`は同じアセンブリ内からのみアクセス可能。
  * `family`はすべての子クラスからアクセス可能。
  * `famandassem`は同じアセンブリ内にあり、かつ子クラスからのみアクセス可能。
  * `famorassem`は同じアセンブリ内か、子クラスからのみアクセス可能。
  * `private`はクラス内からのみアクセス可能。
  * `privatescope`は同じモジュール内の任意の場所からアクセス可能。
    このフラグがデフォルト。
    `privatescope`は親/名前/シグネチャの3組によって識別される。
    つまり同じクラス、同じ名前、同じ型のプライベート項目を複数作成出来てしまうため非推奨。* メソッド
  * インストラクション(命令：ILコードにコンパイルされる)
  * インストラクションをマーキングするラベル
  * ディレクティブ(メタデータ、ヘッダ設定、マネージ例外処理句などにコンパイルされる)
* `.locals`によって宣言されるローカル変数には必ず`init`を指定する
  * 変数がゼロ初期化される
  * 指定しない場合はエラー
    * 実行時に検証が失敗する
    * 検証が無効化されている場合は完全信頼モードでしか動作させられない
* ラベル
  * ラベルに続く***最初の命令***がマークされる
  * 個別の行に分ける必要は無し
* ILは厳密な***スタックベース***の言語
* ilasm 1.0/1.1 では前方方向しか参照できないので場合によって前方宣言する必要がある

## 2章


